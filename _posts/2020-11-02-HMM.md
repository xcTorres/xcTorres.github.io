---
layout:     post
title:      "éšé©¬å°”ç§‘å¤«æ¨¡å‹"
date:       2020-11-02
author:     "xcTorres"
header-img: "img/in-post/HMM/hmm-bg.png"
catalog:    true
mathjax: true
tags:
    - ç®—æ³•
---  

# ç®—æ³•ç®€ä»‹  
ç½‘ä¸Šæœ‰å¾ˆå¤šéšé©¬å°”ç§‘å¤«ç®—æ³•æ¨¡å‹çš„ä»‹ç»ï¼Œå†…å®¹éƒ½éå¸¸è¯¦å®ï¼Œå¦‚æœå¤§å®¶æ„Ÿå…´è¶£å¯åœ¨Referenceä¸­æŸ¥é˜…ç›¸å…³linkã€‚æœ¬æ–‡çš„ç›®çš„æ˜¯å¯¹éšé©¬å°”ç§‘å¤«æ¨¡å‹åšä¸€ä¸ªç®€å•çš„æ¦‚æ‹¬ï¼Œ å¹¶å°è¯•æ¢ç´¢å…¶å¦‚ä½•åº”ç”¨åˆ°**è¯­è¨€é¢†åŸŸ**å’Œ**åœ°å›¾åŒ¹é…é¢†åŸŸ**ã€‚  

é¦–å…ˆæœ€é‡è¦çš„æœ‰ä¸¤ä¸ªé›†åˆ  
- éšè—çŠ¶æ€é›†åˆ  
- è§‚æµ‹çŠ¶æ€é›†åˆ

æœ‰ä¸‰ä¸ªè¾“å…¥
- åˆå§‹çŠ¶æ€åˆ†å¸ƒ $ \Pi $
- çŠ¶æ€è½¬ç§»æ¦‚ç‡åˆ†å¸ƒæ¦‚ç‡  $ A $
- è§‚æµ‹çŠ¶æ€æ¦‚ç‡çŸ©é˜µ $ B $  

HMMç®—æ³•ä¸»è¦å¯ä»¥è§£å†³ä¸€ä¸‹ä¸‰ç±»é—®é¢˜  

### è¯„ä¼°è§‚å¯Ÿåºåˆ—æ¦‚ç‡
å³ç»™å®šæ¨¡å‹ğœ†=(ğ´,ğµ,Î )å’Œè§‚æµ‹åºåˆ—ğ‘‚={ğ‘œ1,ğ‘œ2,...ğ‘œğ‘‡}ï¼Œè®¡ç®—åœ¨æ¨¡å‹ğœ†ä¸‹è§‚æµ‹åºåˆ—ğ‘‚å‡ºç°çš„æ¦‚ç‡
$ P \left( O |\lambda \right) $ã€‚è¿™ä¸ªé—®é¢˜çš„æ±‚è§£éœ€è¦ç”¨åˆ°å‰å‘åå‘ç®—æ³•ã€‚   

å‰å‘åå‘ç®—æ³•ç”¨åˆ°çš„æ˜¯åŠ¨æ€è§„åˆ’ç®—æ³•ï¼Œå³å¯ä»¥ç”¨é€’æ¨æ¥å­˜å‚¨ä¸­é—´ç»“æœï¼Œä»è€Œå°†è®¡ç®—é‡æ•°é‡çº§ä»$ TN^{T}$ é™åˆ°äº†$ TN^{2} $  
  

### æ¨¡å‹å‚æ•°å­¦ä¹ é—®é¢˜ 
å³ç»™å®šè§‚æµ‹åºåˆ—ğ‘‚={ğ‘œ1,ğ‘œ2,...ğ‘œğ‘‡}ï¼Œä¼°è®¡æ¨¡å‹ğœ†=(ğ´,ğµ,Î )çš„å‚æ•°ï¼Œä½¿è¯¥æ¨¡å‹ä¸‹è§‚æµ‹åºåˆ—çš„æ¡ä»¶æ¦‚ç‡
$P \left( O |\lambda \right)$æœ€å¤§ã€‚è¿™ä¸ªé—®é¢˜çš„æ±‚è§£éœ€è¦ç”¨åˆ°åŸºäºEMç®—æ³•çš„é²å§†-éŸ¦å°”å¥‡ç®—æ³•ï¼Œè¿™ä¸ªé—®é¢˜æ˜¯HMMæ¨¡å‹ä¸‰ä¸ªé—®é¢˜ä¸­æœ€å¤æ‚çš„ã€‚   
  

###  é¢„æµ‹é—®é¢˜ï¼Œä¹Ÿç§°ä¸ºè§£ç é—®é¢˜  
å³ç»™å®šæ¨¡å‹ğœ†=(ğ´,ğµ,Î )å’Œè§‚æµ‹åºåˆ—ğ‘‚={ğ‘œ1,ğ‘œ2,...ğ‘œğ‘‡}ï¼Œæ±‚ç»™å®šè§‚æµ‹åºåˆ—æ¡ä»¶ä¸‹ï¼Œæœ€å¯èƒ½å‡ºç°çš„å¯¹åº”çš„çŠ¶æ€åºåˆ—ï¼Œè¿™ä¸ªé—®é¢˜çš„æ±‚è§£éœ€è¦ç”¨åˆ°åŸºäºåŠ¨æ€è§„åˆ’çš„ç»´ç‰¹æ¯”ç®—æ³•ã€‚  

å…³äºHMMç®—æ³•çš„ä»‹ç»å¯å‚ç…§è¯¥link:
[https://github.com/xcTorres/machine_learning/blob/master/HMM.ipynb](https://github.com/xcTorres/machine_learning/blob/master/HMM.ipynb),å…¶ä¸­æœ‰ç»´ç‰¹æ¯”ç®—æ³•çš„ä»£ç ã€‚

# å…·ä½“åº”ç”¨

### ç®—æ³•åº“
[Hmmlearn](https://hmmlearn.readthedocs.io/en/latest/)æ˜¯ä¸€ä¸ªæ¯”è¾ƒæˆç†Ÿçš„ç®—æ³•åº“ï¼Œä»¥ç»´ç‰¹æ¯”ç®—æ³•ä¸ºä¾‹ï¼Œæˆ‘ä»¬è¦åšçš„å°±æ˜¯å¡«å¥½è½¬åŒ–æ¦‚ç‡transform probability matrixä»¥åŠå‘å°„æ¦‚ç‡emission probability matrixã€‚å¦‚ä¸‹ä¸ºdemoä»£ç ç¤ºä¾‹ï¼Œéšè—çŠ¶æ€ä¸ºå¤©æ°”æƒ…å†µï¼Œä¸‹é›¨â˜”ï¸æˆ–è€…æ™´å¤©ğŸŒï¼Œè€Œè§‚æµ‹çŠ¶æ€ä¸ºäººçš„è¡Œä¸ºï¼Œå¾’æ­¥ï¼Œè´­ç‰©ï¼Œæˆ–è€…åœ¨å®¶æ‰“æ‰«å«ç”Ÿã€‚åœ¨å®šä¹‰å®Œè½¬åŒ–æ¦‚ç‡ä»¥åŠå‘å°„æ¦‚ç‡ï¼Œä»¥åŠåˆå§‹æ¦‚ç‡ä¹‹åï¼Œç»™å®šä¸€ä¸ªè§‚å¯Ÿåºåˆ—-äººçš„è¡Œä¸ºï¼Œç”¨ç»´ç‰¹æ¯”ç®—æ³•å°±èƒ½å¾—åˆ°æ¦‚ç‡æœ€å¤§çš„éšè—åºåˆ—-å¤©æ°”çŠ¶å†µã€‚
```python

    import numpy as np
    from hmmlearn import hmm

    states = ["Rainy", "Sunny"]
    n_states = len(states)

    observations = ["walk", "shop", "clean"]
    n_observations = len(observations)

    model = hmm.MultinomialHMM(n_components=n_states, init_params="")
    model.startprob_ = np.array([0.6, 0.4])
    model.transprob_ = np.array([
    [0.7, 0.3],
    [0.4, 0.6]
    ])
    model.emissionprob_ = np.array([
    [0.1, 0.4, 0.5],
    [0.6, 0.3, 0.1]
    ])

    # predict a sequence of hidden states based on visible states
    bob_says = np.array([[0, 2, 1, 1, 2, 0]]).T

    model = model.fit(bob_says)
    logprob, alice_hears = model.decode(bob_says, algorithm="viterbi")
    print("Bob says:", ", ".join(map(lambda x: observations[x], bob_says)))
    print("Alice hears:", ", ".join(map(lambda x: states[x], alice_hears)))

```

### åœ°å›¾åŒ¹é…  
åœ¨æˆ‘ä»¬æ”¶é›†è¡Œè½¦æˆ–è€…éª‘æ‰‹GPSåºåˆ—çš„æ•°æ®æ—¶ï¼Œç”±äºGPSæ•°æ®çš„è¯¯å·®ï¼Œè¿™äº›ç‚¹éƒ½ä¸ä¸€å®šèƒ½æ˜¯åˆšå¥½åœ¨è·¯ä¸Šçš„ã€‚ è€Œç”¨åŸºäºHMMçš„åœ°å›¾åŒ¹é…ç®—æ³•æˆ‘ä»¬å¯ä»¥å¾—åˆ°æ˜ å°„åœ¨è·¯ç½‘ä¸Šçš„çœŸå®è½¨è¿¹ã€‚  å¦‚ä¸‹å›¾å¯ä»¥çœ‹å‡º,åŸå§‹çš„GPS 1ï¼Œ2ï¼Œ3ç‚¹éƒ½ä¸åœ¨è·¯ä¸Šï¼Œä»–ä»¬éƒ½æœ‰ä¸€å®šæ¦‚ç‡æ˜ å°„åœ¨å…¶é™„è¿‘çš„é“è·¯ä¸Šï¼Œä½†ç”±äº1,2ï¼Œ3ç‚¹æ˜¯GPSæ—¶é—´åºåˆ—ï¼Œé‚£ä¹ˆä»–ä»¬ä¹‹é—´ä¹Ÿå°±äº§ç”Ÿäº†è”ç³»ã€‚æ‰€ä»¥ç”¨HMMç®—æ³•æ¥è§£å†³åœ°å›¾åŒ¹é…é—®é¢˜å°±ç†æ‰€å½“ç„¶äº†ã€‚
<img src="/img/in-post/HMM/hmm-1.png" width="200" height="200" title="hmm-1">    

åœ¨åœ°å›¾åŒ¹é…é—®é¢˜ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºéšå˜é‡æ˜¯GPSçœŸå®çš„åœ¨å…¶é™„è¿‘å€™é€‰è·¯ä¸Šçš„ç‚¹åºåˆ—TracePointï¼Œ é‚£ä¹ˆè§‚å¯Ÿå˜é‡å°±æ˜¯æˆ‘ä»¬æ”¶é›†çš„åŸå§‹çš„GPSè½¨è¿¹ã€‚æ¥ä¸‹æ¥å°±æ˜¯å¦‚ä½•æè¿°å‘å°„æ¦‚ç‡å’Œè½¬æ¢æ¦‚ç‡ï¼š
- å‘å°„æ¦‚ç‡ï¼Œå³å„ä¸ªè·¯ä¸Šçš„TracePointåˆ°å…¶å¯¹åº”çš„åŸå§‹GPSçš„æ¦‚ç‡ï¼Œè¿™ä¸ªå¯ä»¥ç”±$\beta$åˆ†å¸ƒæ¥è¡¨è¾¾ï¼Œè€Œ$\beta$åˆ†å¸ƒçš„è‡ªå˜é‡å³æ˜¯TracePointåˆ°Raw GPSçš„çƒé¢è·ç¦»ï¼Œè·ç¦»è¶Šè¿‘åˆ™è¯¥è¡¨æ˜TracePointä¸ºæ­¤æ—¶åˆ»çœŸå®è·¯ä¸Šçš„GPSç‚¹çš„æ¦‚ç‡è¶Šå¤§ã€‚
- è½¬æ¢æ¦‚ç‡ï¼Œ å³å„ä¸ªå€™é€‰è·¯ä¸Šçš„TracePointä¹‹é—´çš„æ¦‚ç‡ï¼Œå¯ä»¥ç”¨æ­£æ€åˆ†å¸ƒæ¥è¡¨è¾¾è¿™ä¸ªæ¦‚ç‡ï¼Œè‡ªå˜é‡å³æ˜¯å„ä¸ªTracePointçš„network distanceå³è·¯ç½‘è·ç¦»å‡å»çƒé¢è·ç¦»çš„å·®çš„ç»å¯¹å€¼ã€‚ç»å¯¹å€¼è¶Šå°çš„æƒ…å†µä¸‹åˆ™ä»£è¡¨ï¼Œä¸¤ä¸ªTracePointè¶Šæœ‰å¯èƒ½åŒåœ¨ä¸€æ¡è·¯ä¸Šæˆ–ç›¸è¿‘è·¯ä¸Šï¼Œæœ‰å¾ˆå¤§çš„æ¦‚ç‡è¿›è¡Œè½¬æ¢ã€‚  
<img src="/img/in-post/HMM/hmm-2.png" width="200" height="200" title="hmm-2">  

è¿™äº›å°±æ˜¯HMMåº”ç”¨åœ¨åœ°å›¾åŒ¹é…ä¸­çš„ç®—æ³•åŸç†ï¼Œåœ¨å®ç°è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬æ‰€éœ€è¦çš„ä¸¤ä¸ªAPIæ˜¯nearest APIï¼ˆç»™å®šä¸€ä¸ªç‚¹ï¼Œç”¨äºå¯»æ‰¾å…¶é™„è¿‘çš„é“è·¯ï¼Œå¹¶å¾—åˆ°è¯¥ç‚¹åœ¨å„ä¸ªé“è·¯ä¸Šçš„æŠ•å½±ç‚¹ï¼‰ï¼Œ route APIï¼ˆç»™å®šèµ·ç‚¹å’Œç»ˆç‚¹ï¼Œè¿”å›ä¸¤ç‚¹ä¹‹é—´çš„è·¯ç½‘è·ç¦»è€Œéçƒé¢è·ç¦»ï¼‰ã€‚æœ‰äº†è¿™ä¸¤ä¸ªAPIå°±èƒ½å®ç°ä¸€ç‰ˆç®€æ˜“ç‰ˆæœ¬çš„åœ°å›¾åŒ¹é…ç®—æ³•äº†ã€‚å¦‚ä¸‹ä¸ºåœ°å›¾åŒ¹é…çš„demo, [https://github.com/xcTorres/machine_learning/tree/master/hmm_demo](https://github.com/xcTorres/machine_learning/tree/master/hmm_demo)ã€‚


## Reference  
[https://towardsdatascience.com/introduction-to-hidden-markov-models-cd2c93e6b781](https://towardsdatascience.com/introduction-to-hidden-markov-models-cd2c93e6b781)  
[https://medium.com/@postsanjay/hidden-markov-models-simplified-c3f58728caab](https://medium.com/@postsanjay/hidden-markov-models-simplified-c3f58728caab)  
[https://github.com/hmmlearn/hmmlearn](https://github.com/hmmlearn/hmmlearn)  
[https://zhuanlan.zhihu.com/p/27907806](https://zhuanlan.zhihu.com/p/27907806)  
[https://zhuanlan.zhihu.com/p/38343732](https://zhuanlan.zhihu.com/p/38343732)  
[https://www.cnblogs.com/pinard/p/6945257.html](https://www.cnblogs.com/pinard/p/6945257.html)  
[https://www.cnblogs.com/mindpuzzle/p/3653043.html](https://www.cnblogs.com/mindpuzzle/p/3653043.html)   
[https://github.com/jagodki/Offline-MapMatching](https://github.com/jagodki/Offline-MapMatching) 






